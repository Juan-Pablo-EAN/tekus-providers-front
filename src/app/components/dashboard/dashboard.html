<div class="dashboard-container"></div>
<!-- Header con título y botón crear -->
<div class="dashboard-header">
  <mat-toolbar color="primary" class="toolbar">
    <div class="toolbar-content">
      <div class="title-section">
        <mat-icon class="header-icon">business</mat-icon>
        <h1 class="dashboard-title">Gestión de Proveedores</h1>
        <span class="provider-count">{{ providers().length }} proveedores registrados</span>
      </div>
      <button
        mat-raised-button
        color="accent"
        class="create-button"
        (click)="onCreateProvider()"
        matTooltip="Agregar nuevo proveedor"
      >
        <mat-icon>add</mat-icon>
        Nuevo Proveedor
      </button>
    </div>
  </mat-toolbar>
</div>

<!-- Contenido principal -->
<div class="dashboard-content">
  <mat-card class="table-card">
    <mat-card-content class="card-content">
      
      <!-- Barra de búsqueda -->
      <div class="search-container">
        <mat-form-field class="search-field" appearance="outline">
          <mat-label>Buscar proveedores...</mat-label>
          <input 
            matInput 
            #searchInput
            (keyup)="applyFilter($event)" 
            placeholder="Buscar por nombre, email, NIT o servicios"
            [value]="searchTerm()"
          />
          <mat-icon matPrefix>search</mat-icon>
          @if (searchTerm()) {
            <button 
              mat-icon-button 
              matSuffix 
              (click)="clearSearch(); searchInput.value = ''"
              matTooltip="Limpiar búsqueda"
            >
              <mat-icon>clear</mat-icon>
            </button>
          }
        </mat-form-field>
        
        <!-- Información de resultados -->
        <div class="search-info">
          <span class="results-count">
            {{ dataSource.filteredData.length }} de {{ providers().length }} proveedores
          </span>
        </div>
      </div>

      <!-- Tabla de proveedores -->
      <div class="table-container">
        <table mat-table [dataSource]="dataSource" class="providers-table" matSort multiTemplateDataRows>
          <!-- Columna ID -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="id-column">ID</th>
            <td mat-cell *matCellDef="let provider" class="id-cell">
              <span class="id-badge">{{ provider.id }}</span>
            </td>
          </ng-container>

          <!-- Columna NIT -->
          <ng-container matColumnDef="nit">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="nit-column">NIT</th>
            <td mat-cell *matCellDef="let provider" class="nit-cell">
              <div class="provider-info">
                <span class="nit-text">{{ provider.nit || 'N/A' }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Columna Nombre -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="name-column">Empresa</th>
            <td mat-cell *matCellDef="let provider" class="name-cell">
              <div class="provider-info">
                <span class="provider-name">{{ provider.name }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Columna Email -->
          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="email-column">Email</th>
            <td mat-cell *matCellDef="let provider" class="email-cell">
              <a [href]="'mailto:' + provider.email" class="email-link">
                {{ provider.email }}
              </a>
            </td>
          </ng-container>

          <!-- Columna Servicios -->
          <ng-container matColumnDef="services">
            <th mat-header-cell *matHeaderCellDef class="services-column">
              Servicios
              <mat-icon class="sort-icon" matTooltip="Los servicios no son ordenables">info</mat-icon>
            </th>
            <td mat-cell *matCellDef="let provider" class="services-cell">
              <mat-chip-set>
                @for (service of provider.services; track $index) {
                <mat-chip class="service-chip" (click)="showInfoService(service)" (keyup)="showInfoService(service)">
                  {{ service.name }}
                </mat-chip>
                }
                @if (provider.services.length === 0) {
                  <span class="no-services">Sin servicios</span>
                }
              </mat-chip-set>
            </td>
          </ng-container>

          <!-- Columna Acciones -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="actions-column">Acciones</th>
            <td mat-cell *matCellDef="let provider" class="actions-cell">
              <div class="action-buttons">
                <button
                  mat-icon-button
                  color="primary"
                  (click)="onEditProvider(provider)"
                  matTooltip="Editar proveedor"
                  class="edit-button"
                >
                  <mat-icon>edit</mat-icon>
                </button>
                <button
                  mat-icon-button
                  color="warn"
                  (click)="onDeleteProvider(provider)"
                  matTooltip="Eliminar proveedor"
                  class="delete-button"
                >
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <!-- Header y filas -->
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns" class="table-row"></tr>

          <!-- Mensaje cuando no hay datos -->
          @if (dataSource.filteredData.length === 0 && providers().length > 0) {
          <tr class="mat-row no-data-row">
            <td class="mat-cell no-data-cell" [attr.colspan]="displayedColumns.length">
              <div class="no-data-content">
                <mat-icon class="no-data-icon">search_off</mat-icon>
                <h3>No se encontraron resultados</h3>
                <p>Intenta con otros términos de búsqueda</p>
                <button mat-button color="primary" (click)="clearSearch(); searchInput.value = ''">
                  <mat-icon>clear</mat-icon>
                  Limpiar búsqueda
                </button>
              </div>
            </td>
          </tr>
          }
          
          @if (providers().length === 0) {
          <tr class="mat-row no-data-row">
            <td class="mat-cell no-data-cell" [attr.colspan]="displayedColumns.length">
              <div class="no-data-content">
                <mat-icon class="no-data-icon">inbox</mat-icon>
                <h3>No hay proveedores registrados</h3>
                <p>Comienza agregando tu primer proveedor haciendo clic en "Nuevo Proveedor"</p>
              </div>
            </td>
          </tr>
          }
        </table>
      </div>

      <!-- Paginador -->
      <mat-paginator 
        #paginator
        [pageSizeOptions]="[5, 10, 20, 50]" 
        [pageSize]="10"
        showFirstLastButtons
        class="table-paginator">
      </mat-paginator>
      
    </mat-card-content>
  </mat-card>
</div>
